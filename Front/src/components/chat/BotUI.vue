<template lang="pug">
.qkb-bot-ui(
  :class="uiClasses"
)
  transition(name="qkb-fadeUp")
    .qkb-board(v-if="botActive")
      BoardHeader(
        :bot-title="optionsMain.botTitle",
        @close-bot="botToggle"
      )
      BoardContent(
        :bot-typing="botTyping",
        :main-data="messages"
      )
      BoardAction(
        :input-disable="inputDisable",
        :input-placeholder="optionsMain.inputPlaceholder",
        :input-disable-placeholder="optionsMain.inputDisablePlaceholder",
        @msg-send="sendMessage"
      )
  .qkb-bot-bubble
    button.qkb-bubble-btn(
      @click="botToggle"
    )
      slot(name="bubbleButton")
        transition(name="qkb-scaleUp")
          BubbleIcon.qkb-bubble-btn-icon(
            v-if="!botActive",
            key="1"
          )
          CloseIcon.qkb-bubble-btn-icon.qkb-bubble-btn-icon--close(
            v-else,
            key="2"
          )
  AppStyle(:options="optionsMain")
  .qkb-preload-image
    .qkb-msg-avatar__img(v-if="optionsMain.botAvatarImg")
</template>
<script>
import EventBus from "@/components/chat_helper/eventbus.js";
import BoardHeader from "@/components/chat/chatBoard/Header.vue";
import BoardContent from "@/components/chat/chatBoard/Content.vue";
import BoardAction from "@/components/chat/chatBoard/Action.vue";
import AppStyle from "@/components/chat/AppStyle.vue";
import BubbleIcon from "@/assets/chatbot/icons/bubble.svg";
import CloseIcon from "@/assets/chatbot/icons/close.svg";
export default {
  name: "VueBotUI",
  components: {
    BoardHeader,
    BoardContent,
    BoardAction,
    BubbleIcon,
    CloseIcon,
    AppStyle,
  },
  props: {
    options: {
      type: Object,
      default: () => {
        return {};
      },
    },
    messages: {
      type: Array,
    },
    botTyping: {
      type: Boolean,
      default: false,
    },
    inputDisable: {
      type: Boolean,
      default: false,
    },
    isOpen: {
      type: Boolean,
      default: false,
    },
  },
  data() {
    return {
      botActive: false,
      defaultOptions: {
        botTitle: "Chatbot",
        colorScheme: "#1b53d0",
        textColor: "#fff",
        bubbleBtnSize: 56,
        animation: true,
        boardContentBg: "#fff",
        botAvatarSize: 32,
        botAvatarImg: "http://placehold.it/200x200",
        msgBubbleBgBot: "#f0f0f0",
        msgBubbleColorBot: "#000",
        msgBubbleBgUser: "#4356e0",
        msgBubbleColorUser: "#fff",
        inputPlaceholder: "Message",
        inputDisableBg: "#fff",
        inputDisablePlaceholder: null,
      },
    };
  },
  computed: {
    optionsMain() {
      return { ...this.defaultOptions, ...this.options };
    },
    // Add class to bot ui wrapper
    uiClasses() {
      let classes = [];
      if (this.optionsMain.animation) {
        classes.push("qkb-bot-ui--animate");
      }
      return classes;
    },
  },
  created() {
    this.initBot();
  },
  mounted() {
    EventBus.$on("select-button-option", this.selectOption);
  },
  beforeDestroy() {
    EventBus.$off("select-button-option");
  },
  methods: {
    initBot() {
      if (this.isOpen) {
        this.botActive = true;
      }
      this.$emit("init");
    },
    botToggle() {
      this.botActive = !this.botActive;
      if (this.botActive) {
        this.$emit("open");
      } else {
        // EventBus.$off('select-button-option')
        this.$emit("destroy");
      }
    },
    sendMessage(value) {
      this.$emit("msg-send", value);
    },
    selectOption(value) {
      this.$emit("msg-send", value);
    },
  },
};
</script>

<style src="@/assets/chatbot/scss/_app.scss" lang="scss"></style>
